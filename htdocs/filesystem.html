<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">
  <title>File System Access</title>
  <meta content="Pt Reference Manual" name="description">
  <meta content="The Pt Development Team" name="author">
  <link rel="stylesheet" href="doxygen.css" type="text/css">
</head>
<body style="margin:0px;">
<div id="container">
<div id="top"> <!-- do not remove this div, it is closed by doxygen! -->
<div id="header">
    <table id="logo">
        <tr>
            <td>
                <a href="../index.html"><img src="platinum-logo.gif" border="0"/></a>
            </td>
            <td>
                <h3>The Power in your Hands</h3>
            </td>
        </tr>
    </table>
    <div class="search">
        <form action="http://search.freefind.com/find.html" method="get" accept-charset="utf-8" target="_self">
          <p style="margin: 0; padding-top:2px; padding-bottom:2px;"><b>Search Site:</b></p>
          <p style="margin: 0; padding:0;">
            <input type="hidden" name="si" value="43943317">
            <input type="hidden" name="pid" value="r">
            <input type="hidden" name="n" value="0">
            <input type="hidden" name="_charset_" value="">
            <input type="hidden" name="bcd" value="&#247;">
            <input style="background-color: #FFFFFF;
                          border: 1px solid #ffffff;
                          font-size: 12px;
                          width: 160px"
                   type="text" name="query" value="Search...">
          </p>
        </form>
    </div>
	<div class="header-menu">
		<div class="header-menu-entry"> 
            <a id="header-menu-link" href="../index.html">About</a> </div>
		<div class="header-menu-entry-sep"></div>
		<div class="header-menu-entry"> 
            <a id="header-menu-link" href="../features-modules.html">Features</a> </div>
		<div class="header-menu-entry-sep"></div>
		<div class="header-menu-entry"> 
            <a id="header-menu-link" href="../docs.html">Documentation</a> </div>
		<div class="header-menu-entry-sep"></div>
		<div class="header-menu-entry"> 
            <a id="header-menu-link" href="../downloads.html">Download</a> </div>
		<div class="header-menu-entry-sep"></div>
		<div class="header-menu-entry"> 
            <a id="header-menu-link" href="../community.html">Community</a> </div>
	</div>
  </div>
<div class="header-submenu" style="padding-left: 146px;">  
    <div class="header-submenu-term"><img src="sub_left.png" width="4" height="20" /></div>
	<div class="header-submenu-entry-sep"></div>
    <div class="header-submenu-entry">
        <a id="header-submenu-link" href="../docs.html">Main</a></div>
	<div class="header-submenu-entry-sep"></div>
    <div class="header-submenu-entry">
        <a id="header-submenu-link" href="classes.html">Classes</a></div>
	<div class="header-submenu-entry-sep"></div>
    <div class="header-submenu-entry">
        <a id="header-submenu-link" href="namespaces.html">Namespaces</a></div>
	<div class="header-submenu-entry-sep"></div>
    <div class="header-submenu-entry">
        <a id="header-submenu-link" href="modules.html">Modules</a></div>
	<div class="header-submenu-entry-sep"></div>
    <div class="header-submenu-term"><img src="sub_right.png" width="4" height="20" /></div>
</div>
<!-- Generated by Doxygen 1.8.6 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">File System Access </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The systems programming library (<a class="el" href="namespacePt_1_1System.html" title="System programming ">Pt::System</a>) provides functionality to identify, create, rename, move or remove files and directories. An iterator based API can be used to traverse through the entries in a directory. It can be used with the iterator based algorithms in the C++ standard library. The FileDevice is an implementation of the IODevice to read and write files.</p>
<h1><a class="anchor" id="filesystem_FileInfo"></a>
File Information</h1>
<p>The <a class="el" href="classPt_1_1System_1_1FileInfo.html" title="Provides information about a node in the file-system. ">Pt::System::FileInfo</a> class provides operations to query information about files and directories in the file system and to add, remove and modify them. FileInfo objects can be created with a path, are assignable, comparable and can be used as keys for e.g. std::map. The path needs not to refer to existing items in the file system, when a FileInfo object is constructed. It can be checked whether a file exists and what type of file it is, as shown in the following example:</p>
<div class="fragment"><div class="line"><a class="code" href="classPt_1_1System_1_1Path.html">Pt::System::Path</a> path(<span class="stringliteral">&quot;/tmp/logout.txt&quot;</span>);</div>
<div class="line"><a class="code" href="classPt_1_1System_1_1FileInfo.html">Pt::System::FileInfo</a> fi(path);</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">if</span>( fi.type() == <a class="code" href="classPt_1_1System_1_1FileInfo.html#a1d1cfd8ffb84e947f82999c682b666a7a1ab5ebbd194ab0b95e5697aca9ba274f">Pt::System::FileInfo::File</a> )</div>
<div class="line">{</div>
<div class="line">    std::cout &lt;&lt; fi.path().toLocal() &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; fi.size() &lt;&lt; <span class="stringliteral">&quot; bytes.\n&quot;</span>;</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">{</div>
<div class="line">    std::cout &lt;&lt; fi.path().toLocal() &lt;&lt; <span class="stringliteral">&quot; is invalid.\n&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Most operations are available as non-member functions, so it is not neccessary to create temporary FileInfo objects. Only the paths to files or directories are required to perform file system operations. The next example illustrates some of the non-member functions for file operations:</p>
<div class="fragment"><div class="line"><span class="keywordflow">try</span></div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classPt_1_1System_1_1Path.html">Pt::System::Path</a> tmp1(<span class="stringliteral">&quot;/tmp/tmpfile1&quot;</span>);</div>
<div class="line">    <a class="code" href="classPt_1_1System_1_1Path.html">Pt::System::Path</a> tmp2(<span class="stringliteral">&quot;/tmp/tmpfile2&quot;</span>);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// create a temporary file</span></div>
<div class="line">    <a class="code" href="classPt_1_1System_1_1FileInfo.html#a57a70d985c294c68ba8306a30128d071">Pt::System::FileInfo::createFile</a>(tmp1);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// move it to a new location</span></div>
<div class="line">    <a class="code" href="classPt_1_1System_1_1FileInfo.html#ac8f45b5b51b6de820c32b05a7f9c31a5">Pt::System::FileInfo::move</a>(tmp1, tmp2);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// remove the file</span></div>
<div class="line">    <a class="code" href="classPt_1_1System_1_1FileInfo.html#aec4796d65717479ce509b807d3a69573">Pt::System::FileInfo::remove</a>(tmp2);</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="classPt_1_1AccessFailed.html">Pt::System::AccessFailed</a>&amp; e)</div>
<div class="line">{</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;file error: &quot;</span> &lt;&lt; e.<a class="code" href="classPt_1_1AccessFailed.html#a1bb1c11ec2a38694bfc6629a3f84c785">resource</a>() &lt;&lt; std::endl;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The code shown above creates a file, moves it to a new location and finally deletes it. If an operation fails, for example because the file could not be created, an exception of type AccessFailed is thrown. This is also the case for all other operations such as size(), createFile(), createDirectory(), resize() and remove(). The exception reports the name of the resource that could not be accessed.</p>
<h1><a class="anchor" id="filesystem_Directory"></a>
Directory Contents</h1>
<p>The <a class="el" href="classPt_1_1System_1_1DirectoryIterator.html" title="Iterates over entries of a directory. ">Pt::System::DirectoryIterator</a> can be used to iterate over the contents of directories. It is created with a path to a directory and satisfies the requirements for a forward iterator. The iterator successivly reads the contents of the assoziated directory and returns a FileInfo when dereferenced. Like the stream iterators of the C++ standard library, it changes to a special state when the end of the directory is reached. This state is identical to a default constructed iterator, so instances thereof can serve as the iterator to the end of the directory.</p>
<div class="fragment"><div class="line"><span class="keywordflow">try</span></div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classPt_1_1System_1_1Path.html">Pt::System::Path</a> path = <span class="stringliteral">&quot;/tmp&quot;</span>;</div>
<div class="line">    <a class="code" href="classPt_1_1System_1_1DirectoryIterator.html">Pt::System::DirectoryIterator</a> it(path);</div>
<div class="line">    <a class="code" href="classPt_1_1System_1_1DirectoryIterator.html">Pt::System::DirectoryIterator</a> end;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>( ; it != end; ++it)</div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;name : &quot;</span> &lt;&lt; it-&gt;<a class="code" href="classPt_1_1System_1_1FileInfo.html#a5b7a11f9806b501fd30a6a7de586ebbe">path</a>().<a class="code" href="classPt_1_1System_1_1Path.html#af440583bc1d445b5c09a93efce52608b">toLocal</a>() &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="classPt_1_1AccessFailed.html">Pt::System::AccessFailed</a>&amp; e)</div>
<div class="line">{</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;failed to access directory&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The constructor throws an AccessFailed exception if the path is not a valid directory. The exception can be avoided by checking the path with <a class="el" href="classPt_1_1System_1_1FileInfo.html#afbd0fa31db28593e9669c3c56711c0a7">FileInfo::type()</a> first, to make sure it is valid. The DirectoryIterator can then be advanced to get the FileInfo for the next file in the directory, until the end of the directory contents is reached.</p>
<h1><a class="anchor" id="filesystem_FileIO"></a>
File I/O</h1>
<p>A <a class="el" href="classPt_1_1System_1_1FileDevice.html" title="Read and write to files. ">Pt::System::FileDevice</a> reads and writes files in the filesystem either synchronously or asynchronously. If used synchronously, it offers similar functionality like a std::fstream or the file I/O functions from the C library (fopen...). However, most applications need to perform input and output asynchronously, which makes using a FileDevice attractive. Since it inherits <a class="el" href="classPt_1_1System_1_1IODevice.html" title="Endpoint for I/O operations. ">Pt::System::IODevice</a>, it can be used as the endpoint of an <a class="el" href="classPt_1_1System_1_1IOStream.html" title="Input/Output stream for I/O devices. ">Pt::System::IOStream</a> or <a class="el" href="classPt_1_1System_1_1IOBuffer.html" title="Implements std::streambuf for I/O devices. ">Pt::System::IOBuffer</a>, respectively. If no buffering is required, a FileDevice can be used on its own, as shown in the following example:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> onOpen(<a class="code" href="classPt_1_1System_1_1FileDevice.html">Pt::System::FileDevice</a>&amp; file);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> onOutput(<a class="code" href="classPt_1_1System_1_1IODevice.html">Pt::System::IODevice</a>&amp; device);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classPt_1_1System_1_1MainLoop.html">Pt::System::MainLoop</a> loop;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classPt_1_1System_1_1FileDevice.html">Pt::System::FileDevice</a> file;</div>
<div class="line">        file.<a class="code" href="classPt_1_1System_1_1Selectable.html#a931676e60334ab733b848fa90dcb6dda">setActive</a>(loop);</div>
<div class="line">        file.<a class="code" href="classPt_1_1System_1_1FileDevice.html#a8947b83e69aeab270e98d4395af337d0">opened</a>() += Pt::slot( &amp;onOpen );</div>
<div class="line">        file.<a class="code" href="classPt_1_1System_1_1IODevice.html#aee6cb622f8b2b5f552f99765d7375e42">outputReady</a>() += Pt::slot( &amp;onOutput );</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classPt_1_1System_1_1Path.html">Pt::System::Path</a> path = <span class="stringliteral">&quot;tmpfile.txt&quot;</span>;</div>
<div class="line">        file.<a class="code" href="classPt_1_1System_1_1FileDevice.html#a31733d5fb687a5778e4ff4571ba2051a">beginOpen</a>(path, std::ios::out);</div>
<div class="line"></div>
<div class="line">        loop.<a class="code" href="classPt_1_1System_1_1EventLoop.html#a13a43e6d814de94978c515cb084873b1">run</a>();</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span>(<a class="code" href="classPt_1_1IOError.html">Pt::System::IOError</a>&amp; e)</div>
<div class="line">    {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;I/O error: &quot;</span> &lt;&lt; e.what() &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
</div><!-- fragment --><p>An EventLoop is required for all asynchronous operations. This includes not only reading and writing, but also opening the file. The function <a class="el" href="classPt_1_1System_1_1FileDevice.html#a31733d5fb687a5778e4ff4571ba2051a">beginOpen()</a> begins to open a file and the signal returned by <a class="el" href="classPt_1_1System_1_1FileDevice.html#a8947b83e69aeab270e98d4395af337d0">opened()</a> is sent when the file was opened. It is connected to the slot shown in the next example:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> onOpen(<a class="code" href="classPt_1_1System_1_1FileDevice.html">Pt::System::FileDevice</a>&amp; file)</div>
<div class="line">{</div>
<div class="line">    file.<a class="code" href="classPt_1_1System_1_1FileDevice.html#a3eaab9a8039703cbc452a0a11c172352">endOpen</a>();</div>
<div class="line">    file.<a class="code" href="classPt_1_1System_1_1IODevice.html#a0f6819a4971e612ac6d0cb54c4d41306">beginWrite</a>(<span class="stringliteral">&quot;Hello world!&quot;</span>, 12);</div>
<div class="line">}</div>
</div><!-- fragment --><p>The asynchronous open operation is ended by calling <a class="el" href="classPt_1_1System_1_1FileDevice.html#a3eaab9a8039703cbc452a0a11c172352">endOpen()</a>, and a write operation is started with <a class="el" href="classPt_1_1System_1_1IODevice.html#a0f6819a4971e612ac6d0cb54c4d41306">beginWrite()</a> to write bytes from a buffer to the file. The signal <a class="el" href="classPt_1_1System_1_1IODevice.html#aee6cb622f8b2b5f552f99765d7375e42">outputReady()</a> is sent, when data was written to the file. A slot is connected to that signal to handle output:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> onOutput(<a class="code" href="classPt_1_1System_1_1IODevice.html">Pt::System::IODevice</a>&amp; device)</div>
<div class="line">{</div>
<div class="line">    std::size_t n = device.<a class="code" href="classPt_1_1System_1_1IODevice.html#a5ec7d50df5d6301755f0f1580c75935b">endWrite</a>();</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;wrote: &quot;</span> &lt;&lt; n &lt;&lt; <span class="stringliteral">&quot;bytes.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The signal is inherited from IODevice, so the signature of the slot needs a reference to a IODevice as parameter. The write operation is ended by <a class="el" href="classPt_1_1System_1_1IODevice.html#a5ec7d50df5d6301755f0f1580c75935b">endWrite()</a>, which returns the number of bytes written to the file. This might be less than what was requested by beginWrite(), in which case another write operation has to be started.</p>
<p>All functions to begin or end asynchronous operations throw an exception of type Pt::System::IOError on failure. If IOErrors are not catched and handled in the slots, they will propagate through the EventLoop into the main() function and end the program. Normally, larger applications will need to process errors in the slots, so the EventLoop is not stopped. </p>
</div></div><!-- contents -->

<div class="clear">&nbsp;</div>
<div id="footer">
	<div style="float:left;">Copyright &copy; 2003-2014 The Pt Development Team</div>
</div>
</div>
</body>
</html>
