<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">
  <title>Unit Testing</title>
  <meta content="Pt Reference Manual" name="description">
  <meta content="The Pt Development Team" name="author">
  <link rel="stylesheet" href="doxygen.css" type="text/css">
</head>
<body style="margin:0px;">
<div id="container">
<div id="top"> <!-- do not remove this div, it is closed by doxygen! -->
<div id="header">
    <table id="logo">
        <tr>
            <td>
                <a href="../index.html"><img src="platinum-logo.gif" border="0"/></a>
            </td>
            <td>
                <h3>The Power in your Hands</h3>
            </td>
        </tr>
    </table>
    <div class="search">
        <form action="http://search.freefind.com/find.html" method="get" accept-charset="utf-8" target="_self">
          <p style="margin: 0; padding-top:2px; padding-bottom:2px;"><b>Search Site:</b></p>
          <p style="margin: 0; padding:0;">
            <input type="hidden" name="si" value="43943317">
            <input type="hidden" name="pid" value="r">
            <input type="hidden" name="n" value="0">
            <input type="hidden" name="_charset_" value="">
            <input type="hidden" name="bcd" value="&#247;">
            <input style="background-color: #FFFFFF;
                          border: 1px solid #ffffff;
                          font-size: 12px;
                          width: 160px"
                   type="text" name="query" value="Search...">
          </p>
        </form>
    </div>
	<div class="header-menu">
		<div class="header-menu-entry"> 
            <a id="header-menu-link" href="../index.html">About</a> </div>
		<div class="header-menu-entry-sep"></div>
		<div class="header-menu-entry"> 
            <a id="header-menu-link" href="../features-modules.html">Features</a> </div>
		<div class="header-menu-entry-sep"></div>
		<div class="header-menu-entry"> 
            <a id="header-menu-link" href="../docs.html">Documentation</a> </div>
		<div class="header-menu-entry-sep"></div>
		<div class="header-menu-entry"> 
            <a id="header-menu-link" href="../downloads.html">Download</a> </div>
		<div class="header-menu-entry-sep"></div>
		<div class="header-menu-entry"> 
            <a id="header-menu-link" href="../community.html">Community</a> </div>
	</div>
  </div>
<div class="header-submenu" style="padding-left: 146px;">  
    <div class="header-submenu-term"><img src="sub_left.png" width="4" height="20" /></div>
	<div class="header-submenu-entry-sep"></div>
    <div class="header-submenu-entry">
        <a id="header-submenu-link" href="../docs.html">Main</a></div>
	<div class="header-submenu-entry-sep"></div>
    <div class="header-submenu-entry">
        <a id="header-submenu-link" href="classes.html">Classes</a></div>
	<div class="header-submenu-entry-sep"></div>
    <div class="header-submenu-entry">
        <a id="header-submenu-link" href="namespaces.html">Namespaces</a></div>
	<div class="header-submenu-entry-sep"></div>
    <div class="header-submenu-entry">
        <a id="header-submenu-link" href="modules.html">Modules</a></div>
	<div class="header-submenu-entry-sep"></div>
    <div class="header-submenu-term"><img src="sub_right.png" width="4" height="20" /></div>
</div>
<!-- Generated by Doxygen 1.8.6 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Unit Testing </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This module provides a complete framework for effective Unit testing. Data-driven, as well as and protocol-driven testing is possible. Unit tests can easily be integrated into the build process and test results can be reported and logged. The output format for reports and logs is configurable.</p>
<h1><a class="anchor" id="unittest_SimpleTests"></a>
A Simple Test Case</h1>
<p>The TestCase class can be used to implement simple unit test. This is simply done by deriving from <a class="el" href="classPt_1_1Unit_1_1TestCase.html" title="Single test with setup and teardown. ">Pt::Unit::TestCase</a> and implementing the test() method. The member functions setUp() and tearDown() can be used to manage any resources the test might require. The PT_UNIT_ASSERT macro can be used to assert test conditions during the test.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>MyTestCase : <span class="keyword">public</span> <a class="code" href="classPt_1_1Unit_1_1TestCase.html">Pt::Unit::TestCase</a></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">        MyTestCase()</div>
<div class="line">        : Pt::Unit::TestCase(<span class="stringliteral">&quot;MyTestCase&quot;</span>)</div>
<div class="line">        , _a(0), _b(0)</div>
<div class="line">        { }</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">void</span> <a class="code" href="classPt_1_1Unit_1_1TestCase.html#a7e11a8ae92c046f17559db9a40055941">setUp</a>()</div>
<div class="line">        {</div>
<div class="line">            _a = 5;</div>
<div class="line">            _b = 5;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">void</span> <a class="code" href="classPt_1_1Unit_1_1TestCase.html#ae409c34c6767ff70d1e29a46fe41dfff">tearDown</a>()</div>
<div class="line">        {</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">void</span> <a class="code" href="classPt_1_1Unit_1_1TestCase.html#a7c0b34520ff7d3c0a9c821b2e21908be">test</a>()</div>
<div class="line">        {</div>
<div class="line">            _a += _b;</div>
<div class="line">            PT_UNIT_ASSERT(_a == 10);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">private</span>:</div>
<div class="line">        <span class="keywordtype">int</span> _a;</div>
<div class="line">        <span class="keywordtype">int</span> _b;</div>
<div class="line">};</div>
</div><!-- fragment --><h1><a class="anchor" id="unittest_BuildSystemIntegration"></a>
Build System Integration</h1>
<p>The Jam build system containes rules to build a unit test and have it run automatically after it has been build. For programs are build as usual with the rule Main. The rule RunUnitTest can be used in a Jamfile to let the unit test execute during the build:</p>
<div class="fragment"><div class="line">Main mytest : mytest.cpp ;</div>
<div class="line">RunUnitTest Pt-test : $(TEST_OUTPUT_DIR) ;</div>
</div><!-- fragment --><p>This will cause the jam tool to report a failed build, if the unit test does not succeed. The second argument for the RunUnitTest rule is the directory, where the test output will be written to. This way unit tests can easily be integrated in automated builds.</p>
<h1><a class="anchor" id="unittest_DataDrivenTesting"></a>
Data Driven Testing</h1>
<p>Sometimes it is desirable to repeat a test with different data. This is achieved by registering methods that take arguments (the test data) in a <a class="el" href="classPt_1_1Unit_1_1TestSuite.html" title="Protocol and data driven testing. ">Pt::Unit::TestSuite</a>.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>MyTestSuite : <span class="keyword">public</span> <a class="code" href="classPt_1_1Unit_1_1TestSuite.html">Pt::Unit::TestSuite</a></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">        MyTestSuite()</div>
<div class="line">        : Pt::Unit::TestSuite(<span class="stringliteral">&quot;MyTestSuite&quot;</span>)</div>
<div class="line">        {</div>
<div class="line">            this-&gt;registerMethod(<span class="stringliteral">&quot;Addition&quot;</span>, *<span class="keyword">this</span>, &amp;MyTestSuite::Addition);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">void</span> Addition(<span class="keywordtype">int</span> a, <span class="keywordtype">int</span> b)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// testing code</span></div>
<div class="line">        }</div>
<div class="line">};</div>
</div><!-- fragment --><p>A protocol can then by used to call the Addition() method multiple times with different data. The data has to be provided as <a class="el" href="classPt_1_1SerializationInfo.html" title="Represents arbitrary types during serialization. ">Pt::SerializationInfo</a> objects, which works for many types without additional code.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>MyTestProtocol : <span class="keyword">public</span> <a class="code" href="classPt_1_1Unit_1_1TestProtocol.html">Pt::Unit::TestProtocol</a></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">        <span class="keywordtype">void</span> <a class="code" href="classPt_1_1Unit_1_1TestProtocol.html#ae78c39ca00150602f1efa6a145971a34">run</a>(<a class="code" href="classPt_1_1Unit_1_1TestSuite.html">Pt::Unit::TestSuite</a>&amp; suite)</div>
<div class="line">        {</div>
<div class="line">            SerializationInfo data[2];</div>
<div class="line"></div>
<div class="line">            data[0] &lt;&lt;= 4;</div>
<div class="line">            data[1] &lt;&lt;= 9;</div>
<div class="line">            suite.<a class="code" href="classPt_1_1Unit_1_1TestSuite.html#a64f8c1b406c4134f9ccbbcd129c08f0a">runTest</a>( <span class="stringliteral">&quot;MyTestSuite::Addition&quot;</span>, data, 2 );</div>
<div class="line"></div>
<div class="line">            data[0] &lt;&lt;= 13;</div>
<div class="line">            data[1] &lt;&lt;= 2;</div>
<div class="line">            suite.<a class="code" href="classPt_1_1Unit_1_1TestSuite.html#a64f8c1b406c4134f9ccbbcd129c08f0a">runTest</a>( <span class="stringliteral">&quot;MyTestSuite::Addition&quot;</span>, data, 2 );</div>
<div class="line">        }</div>
<div class="line">};</div>
</div><!-- fragment --><p>When this protocol is applied to MyTestSuite, the Addition() method will be called twice, each time with different test data. It is often helpful to read the test data from a file or another data source, instead of hardcoding it. The next paragraph explains how a protocol is applied to a test.</p>
<h1><a class="anchor" id="unittest_ProtocolDrivenTesting"></a>
Protocol Driven Testing</h1>
<p>Protocol driven testing implements the idea to control the order in which tests are executed, or to run test methods multiple times. To accomplish this a protocol is defined by deriving from the <a class="el" href="classPt_1_1Unit_1_1TestProtocol.html" title="Protocol for test suites. ">Pt::Unit::TestProtocol</a> class.The following example will run a test called 'MyTest' three times and sleeps between the tests for 1 second.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;Pt/Unit/TestProtocol.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;Pt/System/Process.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>MyProtocol : <span class="keyword">public</span> <a class="code" href="classPt_1_1Unit_1_1TestProtocol.html">Pt::Unit::TestProtocol</a></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">        MyProtocol()</div>
<div class="line">        {}</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">void</span> <a class="code" href="classPt_1_1Unit_1_1TestProtocol.html#ae78c39ca00150602f1efa6a145971a34">run</a>(<a class="code" href="classPt_1_1Unit_1_1TestSuite.html">Pt::Unit::TestSuite</a>&amp; suite)</div>
<div class="line">        {</div>
<div class="line">            suite.<a class="code" href="classPt_1_1Unit_1_1TestSuite.html#a64f8c1b406c4134f9ccbbcd129c08f0a">runTest</a>( <span class="stringliteral">&quot;MyTestMethod&quot;</span> );</div>
<div class="line">            </div>
<div class="line">            <a class="code" href="classPt_1_1System_1_1Thread.html#a3cfabfe1ccc5086cc5753eb45afc4658">Pt::System::Thread::sleep</a>(1000);</div>
<div class="line">            suite.<a class="code" href="classPt_1_1Unit_1_1TestSuite.html#a64f8c1b406c4134f9ccbbcd129c08f0a">runTest</a>( <span class="stringliteral">&quot;MyTestMethod&quot;</span> );</div>
<div class="line">            </div>
<div class="line">            <a class="code" href="classPt_1_1System_1_1Thread.html#a3cfabfe1ccc5086cc5753eb45afc4658">Pt::System::Thread::sleep</a>(1000);</div>
<div class="line">            suite.<a class="code" href="classPt_1_1Unit_1_1TestSuite.html#a64f8c1b406c4134f9ccbbcd129c08f0a">runTest</a>( <span class="stringliteral">&quot;MyTestMethod&quot;</span> );</div>
<div class="line">        }</div>
<div class="line">};</div>
</div><!-- fragment --><p>The methods are resolved by the name they have been registered with. If a test can not be executed through the TestSuite::runTest() method an exception of the type std::runtime_error is thrown and the test fails if the exception is allowed to propagate out of the TestProtocol::run() method. The custom protocol can be assigned to a TestSuite in the constructor:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>MyTestSuite</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">        MyTestSuite()</div>
<div class="line">        : Pt::Unit::TestSuite(<span class="stringliteral">&quot;MyTestSuite&quot;</span>, protocol)</div>
<div class="line">        {</div>
<div class="line">            this-&gt;registerMethod(<span class="stringliteral">&quot;MyTestMethod&quot;</span>, *<span class="keyword">this</span>, &amp;MyTestSuite::MyTestMethod);</div>
<div class="line"></div>
<div class="line">            this-&gt;setProtocol(_protocol);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">void</span> MyTestMethod()</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// testing code</span></div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">    <span class="keyword">private</span>:</div>
<div class="line">        MyProtocol _protocol;</div>
<div class="line">};</div>
</div><!-- fragment --><p>A test protocol can be set using the TestSuite::setProtocol() method. It is therefore possible to load protocols from a custom source and assign them before the test suite is run.</p>
<h1><a class="anchor" id="unittest_RunningTests"></a>
Running Tests</h1>
<p>All tests can be run by the Application object of the <a class="el" href="namespacePt_1_1Unit.html" title="Protocol and data driven Unit-testing. ">Pt::Unit</a> module. To register a test with the application object the RegisterTest class template can be used or Application::registerTest can be called. A typical test program will instanciate an Application object and set reporters for result reporting and logging.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classPt_1_1Unit_1_1Application.html">Pt::Unit::Application</a> app;</div>
<div class="line">    std::ofstream fs(<span class="stringliteral">&quot;log.txt&quot;</span>);</div>
<div class="line">    <a class="code" href="classPt_1_1Unit_1_1Reporter.html">Pt::Unit::Reporter</a> reporter(fs);</div>
<div class="line">    app.setReporter(reporter);</div>
<div class="line">    <span class="keywordflow">return</span> app.<a class="code" href="classPt_1_1Unit_1_1Application.html#ae3046e2660ba8449bfe29805ad210cfc">run</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><p>For convenience, the header file <a class="el" href="TestMain_8h_source.html">TestMain.h</a> already contains such a main() function, where reporters can be selected by command line arguments. So the implementer of a test only has to include <a class="el" href="TestMain_8h_source.html">TestMain.h</a> in the source code, where the main() function would normally be. </p>
</div></div><!-- contents -->

<div class="clear">&nbsp;</div>
<div id="footer">
	<div style="float:left;">Copyright &copy; 2003-2014 The Pt Development Team</div>
</div>
</div>
</body>
</html>
