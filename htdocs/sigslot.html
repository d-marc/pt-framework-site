<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">
  <title>Signals and Delegates</title>
  <meta content="Pt Reference Manual" name="description">
  <meta content="The Pt Development Team" name="author">
  <link rel="stylesheet" href="doxygen.css" type="text/css">
</head>
<body style="margin:0px;">
<div id="container">
<div id="top"> <!-- do not remove this div, it is closed by doxygen! -->
<div id="header">
    <table id="logo">
        <tr>
            <td>
                <a href="../index.html"><img src="platinum-logo.gif" border="0"/></a>
            </td>
            <td>
                <h3>The Power in your Hands</h3>
            </td>
        </tr>
    </table>
    <div class="search">
        <form action="http://search.freefind.com/find.html" method="get" accept-charset="utf-8" target="_self">
          <p style="margin: 0; padding-top:2px; padding-bottom:2px;"><b>Search Site:</b></p>
          <p style="margin: 0; padding:0;">
            <input type="hidden" name="si" value="43943317">
            <input type="hidden" name="pid" value="r">
            <input type="hidden" name="n" value="0">
            <input type="hidden" name="_charset_" value="">
            <input type="hidden" name="bcd" value="&#247;">
            <input style="background-color: #FFFFFF;
                          border: 1px solid #ffffff;
                          font-size: 12px;
                          width: 160px"
                   type="text" name="query" value="Search...">
          </p>
        </form>
    </div>
	<div class="header-menu">
		<div class="header-menu-entry"> 
            <a id="header-menu-link" href="../index.html">About</a> </div>
		<div class="header-menu-entry-sep"></div>
		<div class="header-menu-entry"> 
            <a id="header-menu-link" href="../features-modules.html">Features</a> </div>
		<div class="header-menu-entry-sep"></div>
		<div class="header-menu-entry"> 
            <a id="header-menu-link" href="../docs.html">Documentation</a> </div>
		<div class="header-menu-entry-sep"></div>
		<div class="header-menu-entry"> 
            <a id="header-menu-link" href="../downloads.html">Download</a> </div>
		<div class="header-menu-entry-sep"></div>
		<div class="header-menu-entry"> 
            <a id="header-menu-link" href="../community.html">Community</a> </div>
	</div>
  </div>
<div class="header-submenu" style="padding-left: 146px;">  
    <div class="header-submenu-term"><img src="sub_left.png" width="4" height="20" /></div>
	<div class="header-submenu-entry-sep"></div>
    <div class="header-submenu-entry">
        <a id="header-submenu-link" href="../docs.html">Main</a></div>
	<div class="header-submenu-entry-sep"></div>
    <div class="header-submenu-entry">
        <a id="header-submenu-link" href="classes.html">Classes</a></div>
	<div class="header-submenu-entry-sep"></div>
    <div class="header-submenu-entry">
        <a id="header-submenu-link" href="namespaces.html">Namespaces</a></div>
	<div class="header-submenu-entry-sep"></div>
    <div class="header-submenu-entry">
        <a id="header-submenu-link" href="modules.html">Modules</a></div>
	<div class="header-submenu-entry-sep"></div>
    <div class="header-submenu-term"><img src="sub_right.png" width="4" height="20" /></div>
</div>
<!-- Generated by Doxygen 1.8.6 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Signals and Delegates </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Callback mechanisms for event handling have become ubiqitous in todays application frameworks. Older examples are the use of function pointers as callbacks or the message maps found in the MFC toolkit. More modern approaches include the .NET delegates and so-called signal-slot techniques. When signals and slots are used, objects can communicate with each other by connecting a signal of one object to the slot of another object. In most cases connection management features are built-in so that an object closes all it connections automatically when it gets destroyed. Once the connection has been established, all connected slots are called when a signal is send. Connecting signals to slots is type-safe i.e. a signal can only be connected to a slot that matches the signal's signature. At the same time it allows a great deal of flexibility (loose coupling), since the caller has no intimite knowledge of the callee. A simple but real example might look like this:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classPt_1_1System_1_1Application.html">Pt::System::Application</a> app;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classPt_1_1System_1_1Timer.html">Pt::System::Timer</a> timer;</div>
<div class="line">    timer.<a class="code" href="classPt_1_1System_1_1Timer.html#a1d0ec20a053d1eb6d987d1741e31e7b6">setActive</a>( app.<a class="code" href="classPt_1_1System_1_1Application.html#a9d27135050e141db298170c2e94735e1">loop</a>() );</div>
<div class="line">    timer.<a class="code" href="classPt_1_1System_1_1Timer.html#a84dfa917d34f43228ab9472a2a5d0455">start</a>(1000);</div>
<div class="line">    timer.<a class="code" href="classPt_1_1System_1_1Timer.html#a56c611dce085c482763cf72e18284146">timeout</a>() += Pt::slot(app, &amp;<a class="code" href="classPt_1_1System_1_1Application.html#a358d2e2397ca11ccd17553e3c40e7901">Pt::System::Application::exit</a>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> app.<a class="code" href="classPt_1_1System_1_1Application.html#a13a43e6d814de94978c515cb084873b1">run</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><p>This program will simply exit, when the timer expires after 1000 ms. The application object is the callee and the member function Application::exit serves as a slot. The timer is the caller, which has a signal called timeout.</p>
<h1><a class="anchor" id="sigslot_Signals"></a>
Signals</h1>
<p>Signals are normally members of objects and are being sent e.g. When the object state changes or some event occurs. When a signal is sent, it calls all slots it is connected to. Callable entities, like functions or member functions can serve as slots for signals. The template parameter list of the <a class="el" href="classPt_1_1Signal.html" title="Multicast Signal to call multiple slots. ">Pt::Signal</a> class template determines the signature of the signal. If a signal does not have any arguments the parameter list is left empty:</p>
<div class="fragment"><div class="line"><a class="code" href="classPt_1_1Signal.html">Pt::Signal&lt;&gt;</a> sig0;         <span class="comment">// Signal without arguments</span></div>
<div class="line"><a class="code" href="classPt_1_1Signal.html">Pt::Signal&lt;int&gt;</a> sig1;      <span class="comment">// Signal with one argument</span></div>
<div class="line"><a class="code" href="classPt_1_1Signal.html">Pt::Signal&lt;int, int&gt;</a> sig2; <span class="comment">// Signal with two arguments</span></div>
</div><!-- fragment --><p>Slots can be constructed with the <a class="el" href="classPt_1_1Slot.html">slot()</a> function, which is overloaded for various types of callable entities, most notably functions or member functions. Slots are lightweight proxy-objects and one example is the <a class="el" href="classPt_1_1MethodSlot.html" title="Wraps Method objects so that they can act as Slots. ">Pt::MethodSlot</a>, which allows to use a member function as a slot.</p>
<p>A signal can be connected to a slot if the signatures are compatible. One important feature of <a class="el" href="classPt_1_1Signal.html" title="Multicast Signal to call multiple slots. ">Pt::Signal</a> is that the return value of a slot is ignored and therefore a slot is compatible to a signal no matter what type it returns. The following code example shows how a signal is connected to a function and a member function:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>Callee : <span class="keyword">public</span> <a class="code" href="classPt_1_1Connectable.html">Pt::Connectable</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> slot()</div>
<div class="line">    { std::cout &lt;&lt; <span class="stringliteral">&quot;Callee::slot() called&quot;</span> &lt;&lt; std::endl; }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classPt_1_1Slot.html#afad89cf5ee20b8a8fea05c4acab48793">slot</a>()</div>
<div class="line">{ std::cout &lt;&lt; <span class="stringliteral">&quot;slot() called.&quot;</span> &lt;&lt; std::endl; }</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">    Callee callee;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classPt_1_1Signal.html">Pt::Signal&lt;&gt;</a> signal;</div>
<div class="line">    signal += Pt::slot(<a class="code" href="classPt_1_1Slot.html#afad89cf5ee20b8a8fea05c4acab48793">slot</a>);</div>
<div class="line">    signal += Pt::slot(callee, &amp;Callee::slot);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Two slots are constructed, one from a function pointer and another one from a member function pointer and the object instance to be called. The signal is connected to both slots. Signals can only be connected to objects that derive from <a class="el" href="classPt_1_1Connectable.html" title="Connection Management for Signal and Slot Objects. ">Pt::Connectable</a>, to ensure that all connections are closed when the object runs out of scope and no dangling connections are left. The += operator, to connect a signal with a slot, returns a connection object, which can be used to disconnect signals from slots manually. The following code illustrates this:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="classPt_1_1Slot.html#afad89cf5ee20b8a8fea05c4acab48793">slot</a>()</div>
<div class="line">{ std::cout &lt;&lt; <span class="stringliteral">&quot;slot() called.&quot;</span> &lt;&lt; std::endl; }</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classPt_1_1Signal.html">Pt::Signal&lt;&gt;</a> signal;</div>
<div class="line">    Connection c = signal += Pt::slot(<a class="code" href="classPt_1_1Slot.html#afad89cf5ee20b8a8fea05c4acab48793">slot</a>);</div>
<div class="line">    c.isValid() <span class="comment">// returns true</span></div>
<div class="line"></div>
<div class="line">    c.close();</div>
<div class="line">    c.isValid() <span class="comment">// returns false</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>A connection is reference counted and can not be duplicated as such, but always refers to the same shared connection data. If one peer of a connection is destroyed or the connection is closed manually, the connection becomes invalid. Once a connection has been established, signals can be send to invoke the connected slots. This happens by calling <a class="el" href="classPt_1_1Signal.html#ae120ae4c5489f805cce41e159bbac3de">send()</a> with the appropriate arguments, if any.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> tellAge(<span class="keywordtype">int</span> age)</div>
<div class="line">{ std::cout &lt;&lt; <span class="stringliteral">&quot;I am &quot;</span> &lt;&lt; age &lt;&lt; <span class="stringliteral">&quot; years old\n&quot;</span>; }</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main ()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classPt_1_1Signal.html">Pt::Signal&lt;int&gt;</a> signal;</div>
<div class="line">    signal += Pt::slot(tellAge);</div>
<div class="line">    signal.<a class="code" href="classPt_1_1Signal.html#ae120ae4c5489f805cce41e159bbac3de">send</a>(26);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>When the signal is send, the slot is called with the same value passed to Signal::send. Nothing will happen if the signal is not connected to any slots. When a signal is sent, the slot is called immediatly and directly and does not depend on an event loop. If multiple slots are connected to a signal, the slots will be called one after another.</p>
<h1><a class="anchor" id="sigslot_Delegates"></a>
Delegates</h1>
<p>The <a class="el" href="classPt_1_1Delegate.html" title="Delegates an action to a slot. ">Pt::Delegate</a> is an alternative to the <a class="el" href="classPt_1_1Signal.html" title="Multicast Signal to call multiple slots. ">Pt::Signal</a> and differs from it in two ways. Firstly, delegates forward the return value of the slot and secondly, delegates can only be connected to one slot at a time. The same types of slots can be used for signals and delegates. The template parameter list of the Delegate determines its signature, where the first parameter represents the return type:</p>
<div class="fragment"><div class="line"><a class="code" href="classPt_1_1Delegate.html">Pt::Delegate&lt;int&gt;</a> del0;           <span class="comment">// Delegate only returns int</span></div>
<div class="line"><a class="code" href="classPt_1_1Delegate.html">Pt::Delegate&lt;int, int&gt;</a> del1;      <span class="comment">// Delegate with one argument</span></div>
<div class="line"><a class="code" href="classPt_1_1Delegate.html">Pt::Delegate&lt;int, int, int&gt;</a> del2; <span class="comment">// Delegate with two arguments</span></div>
</div><!-- fragment --><p>The syntax for connecting delegates is identical to how signals are connected to slots. However, since a delegate forwards the return value of its slot, not only the arguments passed to the slot must be compatible, but also the return value. Furthermore, when an already connected delegate is connected again, the current connection will be closed and the delegate is connected to its new target.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> slotA()</div>
<div class="line">{ <span class="keywordflow">return</span> 5; }</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> slotB()</div>
<div class="line">{ <span class="keywordflow">return</span> 6; }</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classPt_1_1Delegate.html">Pt::Delegate&lt;int&gt;</a> delegate;</div>
<div class="line">    delegate += Pt::slot(slotA);</div>
<div class="line">    delegate += Pt::slot(slotB); <span class="comment">// disconnects from slotA</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The example above constructs a delegate which can be connected to any slot that returns an int. It is first connected to a slot of the function slotA. When it is connected for the second time to a slot of the function slotB, the old connection will be closed and only slotB is called when the delegate is called.</p>
<p>There are two possibilities how a delegate can call its slot. The member function <a class="el" href="classPt_1_1Delegate.html#a684e67ec222d30b4fbf06f3e2e3e37ce">call()</a> will return the return value of the slot. If the delegate is not connected to a slot, an exception is thrown. The second method is through <a class="el" href="classPt_1_1Delegate.html#a15fa9ecbf16e46966ced9b70f94b9a71">invoke()</a>, where the return value is ignored, but if the delegate is not connected, no exception will be thrown.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="classPt_1_1Slot.html#afad89cf5ee20b8a8fea05c4acab48793">slot</a>()</div>
<div class="line">{ <span class="keywordflow">return</span> 5; }</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classPt_1_1Delegate.html">Pt::Delegate&lt;int&gt;</a> delegate;</div>
<div class="line">        <a class="code" href="classPt_1_1Connection.html">Pt::Connection</a> connection = delegate += Pt::slot(<a class="code" href="classPt_1_1Slot.html#afad89cf5ee20b8a8fea05c4acab48793">slot</a>);</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">int</span> i = delegate.<a class="code" href="classPt_1_1Delegate.html#a684e67ec222d30b4fbf06f3e2e3e37ce">call</a>(); <span class="comment">// i is 5 now</span></div>
<div class="line"></div>
<div class="line">        connection.<a class="code" href="classPt_1_1Connection.html#a5ae591df94fc66ccb85cbb6565368bca">close</a>();</div>
<div class="line">        delegate.<a class="code" href="classPt_1_1Delegate.html#a15fa9ecbf16e46966ced9b70f94b9a71">invoke</a>() <span class="comment">// does not throw</span></div>
<div class="line">        delegate.<a class="code" href="classPt_1_1Delegate.html#a684e67ec222d30b4fbf06f3e2e3e37ce">call</a>();  <span class="comment">// will throw because not connected</span></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span>(<span class="keyword">const</span> std::logic_error&amp; ex)</div>
<div class="line">    {</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;could not call delegate&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The program above connects a delegate to a slot and then calls it. After the connection was closed, the delegate is invoked, which has no effect. Finally, when the delegate is called again, an exception is thrown and catched. </p>
</div></div><!-- contents -->

<div class="clear">&nbsp;</div>
<div id="footer">
	<div style="float:left;">Copyright &copy; 2003-2014 The Pt Development Team</div>
</div>
</div>
</body>
</html>
